<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TicTacToe</title>
    <link rel="stylesheet" href="./style/style.css">
</head>
<body>
    <div class="root">
        <div class="wrapper">
            <div class="header">
                <h1>TictacToe</h1>
                <h5 class="current_player"></h5>
            </div>
            <div class="content">
                <div class="box_wrapper">
                    <div data-box-index="0" class="box"></div>
                    <div data-box-index="1" class="box"></div>
                    <div data-box-index="2" class="box"></div>
                    <div data-box-index="3" class="box"></div>
                    <div data-box-index="4" class="box"></div>
                    <div data-box-index="5" class="box"></div>
                    <div data-box-index="6" class="box"></div>
                    <div data-box-index="7" class="box"></div>
                    <div data-box-index="8" class="box"></div>
                </div>
            </div>
            <div class="footer">
                <h5 class="game_stat"></h5>
                <button class="game_restart">Restart Game</button>
            </div>
        </div>
    </div>

    <script type="module">
        const statusDisp = document.querySelector('.game_stat');
        const currentPlayerDisp = document.querySelector('.current_player');
        let gameActive = true;
        let currentPlayer = 'X';
        let gameStat= ["","","","","","","","",""];
        const winningCond = [
                [0, 1, 2],
                [3, 4, 5],
                [6, 7, 8],
                [0, 3, 6],
                [1, 4, 7],
                [2, 5, 8],
                [0, 4, 8],
                [2, 4, 6],
            ];

        const message = {
            win: () => {
                return `Player ${currentPlayer} has Won!`
            },
            draw: () => {
                return `Game ended in Draw!`
            },
            playerTurn: () => {
                return `It's ${currentPlayer}'s Turn!`
            }
        }

        currentPlayerDisp.innerHTML = message.playerTurn();

        const handleBoxPlayed = (clickedBox, clickedBoxIndex) => {
            gameStat[clickedBoxIndex] = currentPlayer;
            clickedBox.innerHTML = currentPlayer;
        }

        const handlePlayerChanged = () => {
            currentPlayer = currentPlayer === "X" ? "O" : "X";
            currentPlayerDisp.innerHTML = message.playerTurn();
        }

        const handleResultValid = () => {
            let roundWon = false;
            for (let i = 0; i <= 7; i++) {
                const winCond = winningCond[i];
                let a = gameStat[winCond[0]];
                let b = gameStat[winCond[1]];
                let c = gameStat[winCond[2]];
                if (a === '' || b === '' || c === '') {
                    continue;
                }
                if (a === b && b === c) {
                    roundWon = true;
                    break;
                }
            }
            if (roundWon) {
                statusDisp.innerHTML = message.win();
                gameActive = false;
                return;
            }

            let roundDraw = !gameStat.includes("");
            if (roundDraw) {
                statusDisp.innerHTML = message.draw();
                gameActive = false;
                return;
            }

            handlePlayerChanged();
        }

        const handleBoxClick = (e) => {
            const clickedBox = e.target;

            const clickedBoxIndex = parseInt(clickedBox.getAttribute('data-box-index'));

            if (gameStat[clickedBoxIndex] !== "" || !gameActive) {
                return;
            }

            handleBoxPlayed(clickedBox ,clickedBoxIndex);
            handleResultValid();
        }

        const handleRestartBtn = () => {
            gameActive = true;
            currentPlayer = "X";
            gameStat = ["", "", "", "", "", "", "", "", ""];
            currentPlayerDisp.innerHTML = message.playerTurn();
            document.querySelectorAll('.box').forEach(box => box.innerHTML = "");
        }

        document.querySelectorAll('.box').forEach(box => box.addEventListener('click',(e) => handleBoxClick(e)));
        document.querySelector('.game_restart').addEventListener('click',(e) => handleRestartBtn());
        
    </script>
</body>
</html>
